var Symbol=function(){};
(function(g){function e(f){function c(b){var f=[];if(b.inputs)for(var k=0;k<b.inputs.length;k++)b.inputs[k].name in d||c(b.inputs[k]),f.push(d[b.inputs[k].name]);d[b.name]=e.length;e.push(b);a.push(f)}for(var d={},e=[],a=[],b=0;b<f.length;b++)c(f[b]);return{index:d,order:e,dependencies:a}}g.gradient=function(f,c){var d=e(f),g=d.index,a=d.order,d=d.dependencies,b=Array(a.length);b[b.length-1]=ONE;for(var n=b.length-1;0<=n;n--)if(a[n].grad)for(var p=a[n].grad(b[n]),k=d[n],h=0;h<p.length;h++){var l=
k[h],m=p[h];b[l]=b[l]?b[l].add(m):m}return c.map(function(a){return b[g[a]]})};g.createFunction=function(f){var c=e(f),d=c.order,g=c.dependencies,a=Array(d.length),b=function(b){return a[b]};console.log(c.index);return function(c){for(var e={},k=0,h=0;h<a.length;h++){var l=d[h];a[h]=l.fun?l.fun.apply(l,g[h].map(b)):c[l.name];l.name==f[k].name&&(e[l.name]=a[h],k++)}return e}}})(Symbol);(function(g){var e=function(c){this.name=c};e.prototype={toString:function(){return this.name}};e.ONE=new e("1");var f=function(c,d){this.name=c;this.value=d;this.fun=function(){return this.value}};f.prototype=new e;f.prototype.constructor=f;g.Var=e;g.Param=f})(Symbol);(function(g,e){var f=function(a,b){function c(){return a.apply(this,b)}c.prototype=a.prototype;return new c},c=function(a,b,c){function d(){this.inputs=Array.prototype.slice.call(arguments);this.name=a+"("+this.inputs.map(function(a){return a.name}).join(",")+")";this.fun=b;c&&(this.grad=c)}d.prototype=new e;return function(){return f(d,arguments)}},d=function(a){var b=Array(a.length);return function(){for(var c=f(Symbol.Array,arguments[0].shape),d=0;d<c.flattened.length;d++){for(var e=0;e<arguments.length;e++)b[e]=
arguments[e].flattened[d];c.flattened[d]=a.apply(null,b)}return c}},q=[{name:"add",op:d(function(a,b){return a+b}),grad:function(a){return[a,a]}},{name:"sub",op:d(function(a,b){return a-b})},{name:"mul",op:d(function(a,b){return a*b}),grad:function(a){var b=this.inputs[0];return[this.inputs[1].mul(a),b.mul(a)]}},{name:"div",op:d(function(a,b){return a/b})},{name:"dot",op:function(a,b){for(var c=a.shape[0],d=b.shape[1],e=new Symbol.Array(d),f=0;f<d;f++){for(var g=0,m=0;m<c;m++)g+=a.data[m]*b.data[m][f];
e.data[f]=g}return e}}],d=[{name:"sigmoid",op:d(function(a){return 1/(1+Math.exp(-a))})},{name:"exp",op:d(function(a){return Math.exp(a)})},{name:"tanh",op:d(function(a){a=Math.exp(2*a);return(a-1)/(a+1)})}];q.forEach(function(a){var b=c(a.name,a.op,a.grad);g[a.name]=b;e.prototype[a.name]=function(a){return b(this,a)}});d.forEach(function(a){var b=c(a.name,a.op,a.grad);g[a.name]=b})})(Symbol,Symbol.Var);(function(g){g.Array=function(){function e(c,d){if(1<c.length)for(var g=Array(c[0]),a=0;a<c[0];a++)g[a]=e(c.slice(1),d);else g=new Float32Array(d,4*f,c[0]),f+=c[0];return g}this.shape=Array.prototype.slice.call(arguments);this.size=this.shape.reduce(function(c,d){return c*d},1);this.buffer=new ArrayBuffer(4*this.size);this.flattened=new Float32Array(this.buffer);var f=0;this.data=e(this.shape,this.buffer)};g.Vector=function(e){for(var f=new Symbol.Array(e.length),c=0;c<e.length;c++)f.data[c]=e[c];
return f}})(Symbol);
